# 接口文档

本文档描述了 Django 项目中的两个后台脚本，分别用于更新用户的“可能认识的人”列表和趋势话题。这些脚本作为后台任务运行，用于维护数据库中的数据。

## 1. 更新“可能认识的人”脚本

### 1.1 接口概述

**接口名称**：更新“可能认识的人”  
**接口描述**：该脚本用于更新用户的“可能认识的人”列表，基于用户的二级好友关系（即好友的好友）。  
**版本号**：1.0.0  
**调用方式**：后台任务（非直接 API 调用）

### 1.2 功能说明

- **功能目标**：为每个用户生成并更新“可能认识的人”列表。
- **运行逻辑**：
  1. 遍历数据库中的所有用户。
  2. 清空用户的现有“可能认识的人”列表。
  3. 获取用户的好友列表，遍历每个好友的好友（二级好友）。
  4. 将符合条件的二级好友（非直接好友且不是用户本人）添加到用户的“可能认识的人”列表中。
- **依赖数据**：数据库中 `account.models.User` 模型的 `friends` 和 `people_you_may_know` 字段。

### 1.3 请求参数

| 参数名 | 类型 | 是否必填 | 描述 | 默认值 |
|--------|------|----------|------|--------|
| 无     | -    | -        | 该脚本无显式输入参数，直接从数据库读取数据 | - |

### 1.4 返回参数

| 参数名 | 类型 | 描述 |
|--------|------|------|
| 无     | -    | 该脚本无显式返回结果，直接更新数据库中的 `people_you_may_know` 字段 |

### 1.5 调用示例

#### 示例场景
- **前提**：用户 A 有好友 B，B 有好友 C，A 和 C 无直接好友关系。
- **运行前**：用户 A 的 `people_you_may_know` 为空。
- **运行后**：用户 A 的 `people_you_may_know` 包含用户 C。

#### 调用方式
```bash
# 通过 Django 管理命令运行（假设命令已定义）
python manage.py update_people_you_may_know
```

#### 返回结果
- 无显式返回，数据库中用户 A 的 `people_you_may_know` 字段被更新。

### 1.6 注意事项

- **运行频率**：建议每天或每周运行一次，以保持数据时效性。
- **性能考虑**：用户量较大时执行时间可能较长，建议在低峰期运行。

---

## 2. 更新趋势话题脚本

### 2.1 接口概述

**接口名称**：更新趋势话题  
**接口描述**：该脚本用于更新趋势话题列表，基于过去 24 小时内公开帖子中的话题标签（hashtags）。  
**版本号**：1.0.0  
**调用方式**：后台任务（非直接 API 调用）

### 2.2 功能说明

- **功能目标**：生成并更新数据库中的趋势话题列表。
- **运行逻辑**：
  1. 从过去 24 小时内的公开帖子中提取话题标签。
  2. 统计各话题标签的出现频率。
  3. 将频率最高的前 10 个话题保存到 `post.models.Trend` 模型中。
- **依赖数据**：数据库中 `post.models.Post` 和 `post.models.Trend` 模型。

### 2.3 请求参数

| 参数名 | 类型 | 是否必填 | 描述 | 默认值 |
|--------|------|----------|------|--------|
| 无     | -    | -        | 该脚本无显式输入参数，直接从数据库读取数据 | - |

### 2.4 返回参数

| 参数名 | 类型 | 描述 |
|--------|------|------|
| 无     | -    | 该脚本无显式返回结果，直接更新数据库中的 `Trend` 模型数据 |

### 2.5 调用示例

#### 示例场景
- **前提**：过去 24 小时内，公开帖子中话题标签 `#Python` 出现 50 次，`#Django` 出现 30 次。
- **运行前**：`Trend` 模型中可能包含旧数据。
- **运行后**：`Trend` 模型更新为包含 `#Python`、`#Django` 等前 10 个热门话题。

#### 调用方式
```bash
# 通过 Django 管理命令运行（假设命令已定义）
python manage.py update_trends
```

#### 返回结果
- 无显式返回，数据库中 `Trend` 模型被更新为最新的前 10 个趋势话题。

### 2.6 注意事项

- **运行频率**：建议每小时运行一次，以反映实时趋势。
- **性能考虑**：帖子数据量较大时需优化查询效率。

---

## 公共说明

### 调用方式
- 两个脚本均为后台任务，可通过 Django 管理命令或定时任务（如 Celery）调度运行。
- 示例调度配置（Celery）：
  ```python
  # celery.py
  app.conf.beat_schedule = {
      'update-people-you-may-know': {
          'task': 'tasks.update_people_you_may_know',
          'schedule': crontab(hour=0, minute=0),  # 每天凌晨执行
      },
      'update-trends': {
          'task': 'tasks.update_trends',
          'schedule': crontab(minute=0),  # 每小时执行
      },
  }
  ```