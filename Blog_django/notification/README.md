# Notification 子应用 API 接口文档

## 概述

`notification` 子应用提供了与用户通知相关的功能，包括获取当前用户的未读通知列表和将指定通知标记为已读。本文档详细描述了每个接口的请求方法、URL、参数及返回数据。

## 身份验证

`notification` 子应用的所有接口均需要用户登录并提供身份验证。身份验证通过 JWT 令牌实现，用户需在请求头中提供令牌，格式如下：

```
Authorization: Bearer <token>
```

未提供有效令牌的请求将被拒绝。

---

## 接口列表

### 1. 获取通知列表

#### 接口名称
获取通知列表

#### 接口描述
获取当前用户的未读通知列表。

#### 请求方法
`GET`

#### 请求 URL
`/`

#### 请求参数
无

#### 返回参数

| 参数名               | 类型   | 描述                 |
|----------------------|--------|----------------------|
|                      | array  | 通知列表             |

**返回参数（数组中每个对象）：**

| 参数名                | 类型   | 描述                  |
|-----------------------|--------|-----------------------|
| id                    | string | 通知 ID（UUID 格式）  |
| body                  | string | 通知内容              |
| type_of_notification  | string | 通知类型              |
| post_id               | string | 相关帖子 ID（可选）   |
| created_for_id        | string | 通知接收者 ID         |

#### 示例

**请求：**
```
GET /
Authorization: Bearer <token>
```

**响应：**
```json
[
    {
        "id": "123e4567-e89b-12d3-a456-426614174000",
        "body": "user1 赞了你",
        "type_of_notification": "post_like",
        "post_id": "123e4567-e89b-12d3-a456-426614174001",
        "created_for_id": "123e4567-e89b-12d3-a456-426614174002"
    },
    {
        "id": "123e4567-e89b-12d3-a456-426614174003",
        "body": "user2 评论了你",
        "type_of_notification": "post_comment",
        "post_id": "123e4567-e89b-12d3-a456-426614174004",
        "created_for_id": "123e4567-e89b-12d3-a456-426614174002"
    }
]
```

---

### 2. 标记通知为已读

#### 接口名称
标记通知为已读

#### 接口描述
将指定通知标记为已读。

#### 请求方法
`POST`

#### 请求 URL
`/read/<uuid:pk>/`

#### 请求参数

| 参数名 | 类型 | 是否必填 | 描述        |
|--------|------|----------|-------------|
| pk     | uuid | 是       | 通知 ID     |

#### 返回参数

| 参数名  | 类型   | 描述     |
|---------|--------|----------|
| message | string | 操作结果 |

#### 示例

**请求：**
```
POST /read/123e4567-e89b-12d3-a456-426614174000/
Authorization: Bearer <token>
```

**响应：**
```json
{
    "message": "notification read"
}
```

---

## 注意事项

1. **数据格式**  
   所有接口返回的数据均为 JSON 格式。

2. **通知类型**  
   支持的通知类型包括：
   - `new_friendrequest`：新好友请求
   - `accepted_friendrequest`：好友请求被通过
   - `rejected_friendrequest`：好友请求被拒绝
   - `post_like`：帖子被点赞
   - `post_comment`：帖子被评论

3. **通知内容**  
   通知内容 (`body`) 由 `utils.py` 中的 `create_notification` 函数生成，具体内容根据通知类型动态填充。例如：
   - `post_like`："{用户名称} 赞了你"
   - `new_friendrequest`："{用户名称} 请求加你为好友"

4. **通知创建**  
   `create_notification` 函数用于创建通知，但不直接暴露为 API 接口。该函数由其他子应用调用，用于生成通知。

5. **错误处理**  
   当前代码未显式处理异常情况（如通知不存在或用户无权限访问指定通知）。实际开发中建议添加适当的错误响应，例如：
   - 通知不存在：返回 404 状态码
   - 无权限：返回 403 状态码
